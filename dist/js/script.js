!function(){var e={els:{masterContainer:document.querySelector("#masterContainer"),pages:document.querySelectorAll(".page"),navigation:document.querySelector(".navigation")},data:{currentUser:void 0,products:{visible:void 0,all:void 0,sorting:"none"},users:{all:void 0},requests:[]},goTo:function(e){this.hideAllPages(),document.querySelector('[data-page-id="'+e+'"]').classList.add("active")},hideAllPages:function(){for(var e=0;e<this.els.pages.length;e++)this.els.pages[e].classList.remove("active")},updatePageNavigation:function(){for(var e=this,t=document.querySelectorAll(".page-link"),r=0;r<t.length;r++)t[r].addEventListener("click",function(){var t=this.getAttribute("data-go-to-page");"edit-user"==t&&e.updateEditUserPage(),e.goTo(t)})},getPages:function(e){this.request({type:"GET",url:"api/get-pages.php",callback:function(t){masterContainer.innerHTML=t.markup,e()}})},getMenu:function(e){var t=this;this.request({type:"GET",url:"api/get-menu.php",callback:function(r){t.els.navigation.innerHTML=r.markup,e&&e()}})},getInterface:function(){function e(){r.updateEls(t)}function t(){r.attachFormEvents(),r.updatePageNavigation(),a?(r.goTo("view-products"),"admin"==a.role&&r.getUsers()):r.goTo("landing-page")}var r=this,a=this.data.currentUser;r.getPages(function(){r.getMenu(e),a&&r.getProducts()})},updateEls:function(e){this.els.masterContainer=document.querySelector("#master-container"),this.els.pages=document.querySelectorAll(".page"),this.els.navigation=document.querySelector(".navigation"),e()},signIn:function(){e.request({type:"POST",url:"api/sign-in.php",form:frmLogIn,callback:function(t){"ok"==t.login?(e.data.currentUser=t.user,e.getInterface(),e.clearForm(frmLogIn)):e.activateMessage(txtLoginStatus)}})},signUp:function(){e.checkForm(frmSignUp,function(t){"ok"==t?e.request({type:"POST",url:"api/add-user.php",form:frmSignUp,callback:function(t){"succes"==t.status?(e.data.currentUser=t.user,e.getInterface(),e.clearForm(frmSignUp)):"error"==t.status&&e.activateMessage(msgAddUserPhoneOrEmailTaken)}}):e.activateMessage(msgAddUserMissingFields)})},signOut:function(){e.request({type:"GET",url:"api/sign-out.php",callback:function(){e.data.currentUser=void 0,e.getInterface()}})},editUser:function(t){var r=new FormData(frmEditUser),a=document.querySelector(".page.active .user").getAttribute("data-user-id");r.append("txtId",a),e.request({type:"POST",url:"api/edit-user.php",data:r,callback:function(t){"admin"==e.data.currentUser.role?e.getUsers():e.data.currentUser=t.user,e.activateMessage(txtEditUserMessage),e.getInterface()}})},updateEditUserPage:function(e){if("admin"==this.data.currentUser.role&&e){for(var t=0;t<this.data.users.all.length;t++)if(this.data.users.all[t].id==e)r=this.data.users.all[t]}else var r=this.data.currentUser;var a=document.querySelectorAll('[data-page-id="edit-user"] [name="txtFirstName"]')[0],i=document.querySelectorAll('[data-page-id="edit-user"] [name="txtLastName"]')[0],n=document.querySelectorAll('[data-page-id="edit-user"] [name="txtPhone"]')[0],s=document.querySelectorAll('[data-page-id="edit-user"] [name="txtEmail"]')[0];a.value=r.firstName,i.value=r.lastName,n.value=r.phone,s.value=r.email;var d='      <div class="user u_mb-xxl" data-user-id="'+r.id+'">        <div class="profile-picture" style="background-image: url(images/profile-pictures/'+r.profilePicture+')">        </div>        <div class="info">          <p class="name">'+r.firstName+" "+r.lastName+'</p>          <p class="phone">'+r.phone+'</p>          <p class="email">'+r.email+'</p>          <p class="role">'+r.role+"</p>        </div>      </div>";displayCurrentUserData.innerHTML=d},deleteUser:function(){e.request({type:"GET",url:"api/delete-user.php",callback:function(t){e.data.currentUser=void 0,e.getInterface()}})},getUsers:function(){e.request({type:"GET",url:"api/get-users.php",callback:function(t){e.data.users.all=t,e.renderUsers()}})},renderUsers:function(){for(var t="",r=e.data.users.all,a=0;a<r.length;a++)r[a].id!==e.data.currentUser.id&&(t+='        <div class="user">          <div class="profile-picture" style="background-image: url(images/profile-pictures/'+r[a].profilePicture+')">          </div>          <div class="info">            <p class="name">'+r[a].firstName+" "+r[a].lastName+'</p>            <p class="phone">'+r[a].phone+'</p>            <p class="email">'+r[a].email+'</p>            <p class="role">'+r[a].role+'</p>          </div>          <div class="dropdown">            <div class="title">              <i class="material-icons">more_vert</i>            </div>            <div class="content">              <a class="btnAdminEditUser" data-user-id="'+r[a].id+'"><i class="material-icons">edit</i>Edit user</a>              <a class="btnAdminDeleteUser" data-user-id="'+r[a].id+'"><i class="material-icons">delete</i>Delete user</a>            </div>          </div>        </div>');usersContainer.innerHTML=t,e.enableAdminUserEdit(),e.enableAdminUserDelete()},enableAdminUserEdit:function(){for(var t=document.querySelectorAll(".btnAdminEditUser"),r=0;r<t.length;r++)t[r].addEventListener("click",function(t){e.getEl(t.path,"user");var r=this.getAttribute("data-user-id");e.updateEditUserPage(r),e.goTo("edit-user")})},enableAdminUserDelete:function(){for(var t=document.querySelectorAll(".btnAdminDeleteUser"),r=0;r<t.length;r++)t[r].addEventListener("click",function(t){var r=e.getEl(t.path,"user"),a=this.getAttribute("data-user-id"),i=new FormData;i.append("sUserId",a),e.request({type:"POST",url:"api/delete-user.php",data:i,callback:function(){r.classList.add("deleted")}})})},IsUserSignedIn:function(){e.request({type:"GET",url:"api/is-user-signed-in.php",callback:function(t){e.data.currentUser=t.user,e.getInterface()}})},addProduct:function(){e.checkForm(frmAddProduct,function(t){"ok"==t?e.request({type:"POST",url:"api/add-product.php",form:frmAddProduct,callback:function(){e.activateMessage(txtAddProductMessage),e.getProducts(),e.clearForm(frmAddProduct)}}):e.activateMessage(msgAddProductMissingFields)})},editProduct:function(){e.request({type:"POST",url:"api/edit-product.php",form:frmEditProduct,callback:function(t){e.getProducts(),e.goTo("view-products")}})},deleteProduct:function(){e.request({type:"POST",url:"api/delete-product.php",form:frmEditProduct,callback:function(t){e.getProducts(),e.goTo("view-products"),e.activateMessage(txtDeleteProductMessage)}})},getProducts:function(){e.request({type:"GET",url:"api/get-products.php",callback:function(t){e.data.products.all=t,e.data.products.visible=t,e.renderProducts(function(){e.enableProductFiltering(),e.enableProductSorting()})}})},renderProducts:function(t){var r="",a=e.data.products.visible;if("none"!==e.data.products.sorting&&(a=e.sortProducts(a,"price",e.data.products.sorting)),a.length)for(var i=0;i<a.length;i++){n="";if(e.data.currentUser.id==a[i].createdBy||"admin"==e.data.currentUser.role)var n='<a class="edit-product btnEditProductLink" data-product-id="'+a[i].id+'">Edit</a>';sProduct='<div class="product">          '+n+'          <div class="image" style="background-image: url(images/product-pictures/'+a[i].picture+')"></div>          <p class="title">'+a[i].name+'</p>          <p class="price">'+a[i].price+" DKK</p>        </div>",r+=sProduct}else r="<p class='u-mlr-auto'>No products found...</p>";productContainer.innerHTML=r,e.updateEditProductLinks(),txtVisibleProductStatus.innerText="Showing "+a.length+" out of "+e.data.products.all.length+" products",t&&t()},updateEditProductLinks:function(){for(var t=document.querySelectorAll(".btnEditProductLink"),r=0;r<t.length;r++)t[r].addEventListener("click",function(){var t=this.getAttribute("data-product-id");e.updateEditProductForm(t)})},updateEditProductForm:function(t){e.activateSpinner(),e.request({type:"GET",url:"api/get-product.php?productId="+t,callback:function(t){var r=document.querySelectorAll('[data-page-id="edit-product"] [name="txtProductName"]')[0],a=document.querySelectorAll('[data-page-id="edit-product"] [name="txtProductPrice"]')[0],i=document.querySelectorAll('[data-page-id="edit-product"] [name="txtProductId"]')[0];r.value=t.name,a.value=t.price,i.value=t.id,e.goTo("edit-product"),e.deactivateSpinner(),e.attachFormEvents()}})},enableProductFiltering:function(){inputFilterProducts.addEventListener("keyup",e.filterProducts)},filterProducts:function(t){clearTimeout(r);var r=setTimeout(function(){var r=t.target.value,a=new RegExp(r,"gi"),i=e.data.products.all;e.data.products.visible=[];for(var n=0;n<i.length;n++)-1!==i[n].name.search(a)&&"null"!=typeof i[n].name&&e.data.products.visible.push(i[n]);e.renderProducts()},100)},enableProductSorting:function(){btnSortAscending.addEventListener("click",function(){e.data.products.sorting="ascending",btnSortAscending.classList.add("selected"),btnSortDecending.classList.remove("selected"),e.renderProducts()}),btnSortDecending.addEventListener("click",function(){e.data.products.sorting="descending",btnSortDecending.classList.add("selected"),btnSortAscending.classList.remove("selected"),e.renderProducts()})},sortProducts:function(e,t,r){return e.sort(function(e,a){return"ascending"==r?e[t]-a[t]:a[t]-e[t]}),e},attachFormEvents:function(){"undefined"!=typeof btnSignUp&&btnSignUp.addEventListener("click",this.signUp),"undefined"!=typeof btnSignIn&&btnSignIn.addEventListener("click",this.signIn),"undefined"!=typeof btnSignOut&&btnSignOut.addEventListener("click",this.signOut),"undefined"!=typeof btnEditUser&&btnEditUser.addEventListener("click",this.editUser),"undefined"!=typeof btnDeleteUser&&btnDeleteUser.addEventListener("click",this.deleteUser),"undefined"!=typeof btnAddProduct&&btnAddProduct.addEventListener("click",this.addProduct),"undefined"!=typeof btnEditProduct&&btnEditProduct.addEventListener("click",this.editProduct),"undefined"!=typeof btnDeleteProduct&&btnDeleteProduct.addEventListener("click",this.deleteProduct)},request:function(t){e.activateSpinner();var r=new XMLHttpRequest;if(r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=e.data.requests.indexOf(r);e.data.requests.splice(a,1);var i=JSON.parse(this.response);t.callback(i),0==e.data.requests.length&&e.deactivateSpinner()}},r.open(t.type,t.url,!0),"POST"==t.type&&t.form){var a=new FormData(t.form);r.send(a)}else"POST"==t.type&&t.data?r.send(t.data):(r.send(),e.data.requests.push(r))},activateMessage:function(e){for(var t=document.querySelectorAll(".message.active"),r=0;r<t.length;r++)t[r].classList.remove("active");e.classList.add("active"),setTimeout(function(){e.classList.remove("active")},1e4)},activateSpinner:function(){spinner.classList.add("active")},deactivateSpinner:function(){spinner.classList.remove("active")},getEl:function(e,t){for(var r=0;r<e.length;r++)if(e[r].classList.contains(t))return e[r]},checkForm:function(e,t){for(var r=0,a=0;a<e.children.length;a++){var i=e.children[a];i.value||!i.classList.contains("required")||"INPUT"!=i.tagName&&"SELECT"!=i.tagName?i.value&&i.classList.contains("required")&&i.classList.contains("error-value-missing")&&("INPUT"==i.tagName||"SELECT"==i.tagName)&&i.classList.remove("error-value-missing"):(i.classList.add("error-value-missing"),r++)}t(0==r?"ok":"error")},clearForm:function(e){for(var t=0;t<e.children.length;t++)e.children[t].value=""},submitFormOnEnter:function(){window.addEventListener("keydown",function(e){var t=document.querySelector(".page.active .button.positive");"Enter"===e.key&&t&&t.click()})},init:function(){this.IsUserSignedIn(),this.submitFormOnEnter()}};e.init()}();